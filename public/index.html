<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Token Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
    
    <style>
        :root {
            --primary: #26A69A;
            --secondary: #80CBC4;
            --background: #F5F5F5;
            --surface: #FFFFFF;
            --on-surface: #424242;
            --divider: #E0E0E0;
            --error: #FF5252;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 24px;
            background-color: var(--background);
            color: var(--on-surface);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--surface);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .load-more {
            text-align: center;
            margin: 20px 0;
        }
        
        #loadMoreButton {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        #loadMoreButton:hover {
            opacity: 0.9;
        }

        #loadMoreButton:disabled {
            background: var(--divider);
            cursor: not-allowed;
        }

        .wallet-pagination-controls {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
        }

        .wallet-pagination-controls button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .wallet-pagination-controls button:disabled {
            background: var(--divider);
            cursor: not-allowed;
        }

        /* Keep all previous existing styles and add these new ones */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- Existing header content -->
        </div>
        
        <div class="token-list" id="tokenList"></div>
        <div class="load-more">
            <button id="loadMoreButton" onclick="loadMoreTokens()">Load More Tokens</button>
        </div>

        <div class="wallet-tokens-section" id="walletTokensSection" style="display: none;">
            <h2>Your Wallet's Token Holdings</h2>
            <div class="wallet-pagination-controls">
                <button id="walletPrev" onclick="changeWalletPage(-1)">← Previous</button>
                <span id="walletPageNumber">Page 1</span>
                <button id="walletNext" onclick="changeWalletPage(1)">Next →</button>
            </div>
            <table id="walletTokensTable">
                <thead>
                    <tr>
                        <th>Token Name</th>
                        <th>Mint Address</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div id="walletError" class="error-message"></div>
        </div>
    </div>

    <script>
        let currentSort = 'newest';
        let tokenCurrentPage = 1;
        let walletCurrentPage = 1;
        const ITEMS_PER_PAGE = 10;
        let allWalletTokens = [];
        let displayedSignatures = new Set();

        async function fetchTokens() {
            try {
                const response = await fetch(`/tokens?page=${tokenCurrentPage}&limit=${ITEMS_PER_PAGE}`);
                const { tokens, total } = await response.json();
                
                document.getElementById('loadMoreButton').disabled = 
                    (tokenCurrentPage * ITEMS_PER_PAGE) >= total;

                updateTokenList(tokens);
            } catch (error) {
                console.error('Error fetching tokens:', error);
            }
        }

        function updateTokenList(tokens) {
            const container = document.getElementById('tokenList');
            const sortedTokens = sortTokens([...tokens]);

            sortedTokens.forEach(token => {
                if (!displayedSignatures.has(token.signature)) {
                    displayedSignatures.add(token.signature);
                    const tokenCard = createTokenCard(token);
                    container.appendChild(tokenCard);
                }
            });
        }

        function createTokenCard(token) {
            const tokenCard = document.createElement('div');
            tokenCard.className = 'token-card';
            tokenCard.innerHTML = `
                <div class="timestamp">
                    <span class="material-icons">schedule</span>
                    ${token.timestamp}
                </div>
                <div class="token-name">Name: ${token.name || 'N/A'}</div>
                <div class="token-symbol">Symbol: ${token.symbol || 'N/A'}</div>
                <div class="mint-address">Mint: ${token.mintAddress}</div>
                <div class="tx-signature">
                    TX: <a href="${token.explorerLink}" target="_blank">${token.signature.slice(0, 20)}...</a>
                </div>
                <div class="total-supply">Total Supply: ${token.totalSupply}</div>
                <div class="mint-authority">Mint Authority: ${token.mintAuthority}</div>
                <div class="freeze-authority">Freeze Authority: ${token.freezeAuthority}</div>
            `;
            return tokenCard;
        }

        function loadMoreTokens() {
            tokenCurrentPage++;
            fetchTokens();
        }

        // Wallet Pagination Functions
        async function fetchWalletTokens(publicKey) {
            walletErrorDiv.textContent = '';
            walletTokensTableBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';

            try {
                const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
                    publicKey,
                    { programId: new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA') }
                );

                allWalletTokens = await Promise.all(tokenAccounts.value.map(async (accountInfo) => {
                    const accountData = accountInfo.account.data.parsed.info;
                    const mintAddress = accountData.mint;
                    const amount = accountData.tokenAmount.uiAmount;
                    const tokenDetails = await fetchTokenDetails(mintAddress);
                    return {
                        name: tokenDetails?.name || 'Unknown Token',
                        mintAddress,
                        amount
                    };
                }));

                updateWalletTable();
            } catch (error) {
                console.error('Error fetching wallet tokens:', error);
                walletErrorDiv.textContent = 'Failed to fetch wallet tokens. Please try again.';
                walletTokensTableBody.innerHTML = '';
            }
        }

        function updateWalletTable() {
            const start = (walletCurrentPage - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageTokens = allWalletTokens.slice(start, end);
            const tbody = document.querySelector('#walletTokensTable tbody');

            tbody.innerHTML = pageTokens.map(token => `
                <tr>
                    <td>${token.name}</td>
                    <td>${token.mintAddress}</td>
                    <td>${token.amount}</td>
                </tr>
            `).join('');

            document.getElementById('walletPageNumber').textContent = 
                `Page ${walletCurrentPage} of ${Math.ceil(allWalletTokens.length / ITEMS_PER_PAGE)}`;
            document.getElementById('walletPrev').disabled = walletCurrentPage === 1;
            document.getElementById('walletNext').disabled = 
                walletCurrentPage * ITEMS_PER_PAGE >= allWalletTokens.length;
        }

        function changeWalletPage(delta) {
            walletCurrentPage += delta;
            updateWalletTable();
        }

        // Keep all existing Solana connection and other functions
        // Add the remaining original JavaScript code here
    </script>
</body>
</html>